---
import "../../../styles/global.css";
import Header from "../../../components/Header.astro";
import Footer from "../../../components/Footer.astro";
import books from "../../../data/books.json";

export function getStaticPaths() {
  return books.map((book) => ({
    params: { id: book.id.toString() },
    props: { book },
  }));
}

const { book } = Astro.props;

// Aqu√≠ cargar√≠as el JSON detallado del libro
// Por ejemplo, si tienes archivos como /data/books/1.json, 2.json, etc.
let detailedBook;
try {
  detailedBook = await import(`../../../data/books/${book.id}.json`);
  detailedBook = detailedBook.default;
} catch (e) {
  // Si no existe el archivo detallado, usa la info b√°sica
  detailedBook = book;
}

// Determinar colores seg√∫n categor√≠a
let colorClass = "text-gray-800";
let bgGradient = "from-gray-100 to-gray-200";
let accentColor = "purple";

if (book.category === "Romance Oscuro") {
  colorClass = "text-red-600";
  bgGradient = "from-red-100 to-pink-200";
  accentColor = "red";
} else if (book.category === "Saga Bellamy") {
  colorClass = "text-purple-600";
  bgGradient = "from-purple-100 to-blue-200";
  accentColor = "purple";
} else if (book.category === "Historia Alternativa") {
  colorClass = "text-emerald-600";
  bgGradient = "from-emerald-100 to-teal-200";
  accentColor = "emerald";
}
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{book.title} - Vane S√°nchez</title>
    <meta
      name="description"
      content={detailedBook.description
        ? detailedBook.description.substring(0, 160) + "..."
        : `Descubre ${book.title} por Vane S√°nchez`}
    />
  </head>
  <body
    class={`font-serif bg-gradient-to-br ${bgGradient} min-h-screen text-gray-800`}
  >
    <Header />

    <main class="mt-24 min-h-screen">
      <div class="max-w-6xl mx-auto px-4 py-8">
        <!-- Contenido principal -->
        <div
          class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl overflow-hidden"
        >
          <div class="grid md:grid-cols-2 gap-8">
            <!-- Imagen del libro -->
            <div class="p-8">
              <div class="sticky top-8">
                <img
                  src={book.cover}
                  alt={book.title}
                  class="w-full max-w-md mx-auto rounded-lg shadow-lg"
                />

                <!-- Estado del libro -->
                {
                  detailedBook.status && (
                    <div class="mt-4 text-center">
                      <span
                        class={`inline-block px-4 py-2 rounded-full text-sm font-semibold 
                      ${
                        detailedBook.status === "Completo"
                          ? "bg-green-100 text-green-800"
                          : detailedBook.status === "En progreso"
                            ? "bg-yellow-100 text-yellow-800"
                            : "bg-gray-100 text-gray-800"
                      }`}
                      >
                        {detailedBook.status}
                      </span>
                    </div>
                  )
                }

                <!-- Cap√≠tulos totales -->
                {
                  detailedBook.chapters && detailedBook.chapters.length > 0 && (
                    <div class="mt-2 text-center text-gray-600">
                      {detailedBook.chapters.length} cap√≠tulos
                    </div>
                  )
                }
              </div>
              <!-- Tags -->
              <div class="flex flex-wrap gap-2 my-6">
                {
                  book.tags.map((tag) => (
                    <span class="bg-gray-100 px-3 py-1 rounded-full text-sm text-gray-700">
                      {tag}
                    </span>
                  ))
                }
              </div>
            </div>

            <!-- Informaci√≥n del libro -->
            <div class="p-8">
              <h1 class={`text-4xl md:text-5xl font-bold mb-4 ${colorClass}`}>
                {book.title}
              </h1>

              <!-- Categor√≠a -->
              <div class="mb-6">
                <span
                  class={`inline-block px-4 py-2 rounded-full text-sm font-semibold bg-${accentColor}-100 text-${accentColor}-800`}
                >
                  {book.category}
                </span>
              </div>

              <!-- Descripci√≥n -->
              {
                detailedBook.description && (
                  <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">
                      Sinopsis
                    </h2>
                    <div class="prose prose-gray max-w-none">
                      {detailedBook.description
                        .split("\n")
                        .map(
                          (paragraph: string, index: number) =>
                            paragraph.trim() && (
                              <p class="mb-4 text-gray-700 leading-relaxed">
                                {paragraph}
                              </p>
                            )
                        )}
                    </div>
                  </div>
                )
              }

              <!-- Advertencia para Romance Oscuro -->
              {
                book.category === "Romance Oscuro" && (
                  <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
                    <p class="text-red-800 text-sm">
                      <strong>‚ö†Ô∏è Advertencia:</strong> Esta novela contiene
                      temas sensibles: relaciones t√≥xicas, adicci√≥n, violencia
                      emocional y situaciones adultas. Recomendada para lectores
                      mayores de 18 a√±os.
                    </p>
                  </div>
                )
              }

              <!-- Botones de acci√≥n -->
              <div class="space-y-4">
                <div class="text-sm text-gray-600">
                  <strong>Versi√≥n censurada disponible</strong> - Versi√≥n completa
                  en f√≠sico
                </div>

                {
                  detailedBook.chapters && detailedBook.chapters.length > 0 && (
                    <div>
                      <a
                        href={`/libro/${book.id}/capitulo/1`}
                        class={`inline-block bg-gradient-to-r ${
                          book.category === "Romance Oscuro"
                            ? "from-red-600 to-red-700 hover:from-red-700 hover:to-red-800"
                            : book.category === "Historia Alternativa"
                              ? "from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800"
                              : "from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800"
                        } text-white px-8 py-3 rounded-full font-bold transition-all duration-300 transform hover:-translate-y-1 shadow-lg`}
                      >
                        Comenzar a leer üìñ
                      </a>
                    </div>
                  )
                }
              </div>
            </div>
          </div>

          <!-- Lista de cap√≠tulos -->
          {
            detailedBook.chapters && detailedBook.chapters.length > 0 && (
              <div class="border-t border-gray-200 p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Cap√≠tulos</h2>
                <div class="grid gap-4">
                  {detailedBook.chapters.map(
                    (chapter: { id: number; title: string }, index: number) => (
                      <a
                        href={`/libro/${book.id}/capitulo/${chapter.id}`}
                        class="flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors group"
                      >
                        <div>
                          <span class="font-semibold text-gray-800 group-hover:text-purple-600">
                            {chapter.title}
                          </span>
                        </div>
                        <span class="text-gray-500 group-hover:text-purple-600 group-hover:translate-x-1 transition-all">
                          ‚Üí
                        </span>
                      </a>
                    )
                  )}
                </div>
              </div>
            )
          }
        </div>
      </div>
    </main>

    <Footer />
  </body>
</html>
